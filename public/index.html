<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BizDoc — AI Document Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; background:#0b1220; color:#e8eefc; margin:0; padding:24px; }
    .card { background:#0f172a; border:1px solid #26304b; border-radius:16px; padding:20px; max-width:760px; margin:0 auto; }
    textarea, input[type="file"] { width:100%; margin-top:8px; }
    button { background:#162244; color:#e8eefc; border:1px solid #2a3a66; border-radius:10px; padding:10px 14px; cursor:pointer; }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .muted { color:#9fb3d2; font-size:12px; }
    pre { white-space:pre-wrap; background:#0b1220; border:1px solid #26304b; padding:12px; border-radius:12px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>BizDoc — AI Document Analyzer</h2>
    <p class="muted">PDFs work best. You’ll get a downloadable text report.</p>

    <div>
      <label>Document</label>
      <input id="file" type="file" accept=".pdf,.txt,.md,.csv,.json,.doc,.docx,.rtf" />
    </div>

    <div style="margin-top:12px;">
      <label>Instruction (optional)</label>
      <textarea id="instruction" rows="4" placeholder="e.g., Summarize key risks, KPIs, and next actions."></textarea>
    </div>

    <div class="row" style="margin-top:16px;">
      <button id="analyze">Analyze</button>
      <button id="download" disabled>Download TXT</button>
      <span id="status" class="muted"></span>
    </div>

    <div style="margin-top:16px;">
      <label>Result</label>
      <pre id="result">—</pre>
    </div>
  </div>

  <script>
    const API = "/api/analyze"; // same origin inside the Vercel app

    const $ = (id) => document.getElementById(id);
    const fileInput = $("file");
    const instruction = $("instruction");
    const analyzeBtn = $("analyze");
    const downloadBtn = $("download");
    const resultEl = $("result");
    const statusEl = $("status");

    let lastText = "";

    analyzeBtn.onclick = async () => {
      const f = fileInput.files?.[0];
      if (!f) { alert("Please choose a file"); return; }

      analyzeBtn.disabled = true;
      downloadBtn.disabled = true;
      resultEl.textContent = "Working...";
      statusEl.textContent = "Uploading & analyzing...";

      const fd = new FormData();
      fd.append("file", f);
      fd.append("instruction", instruction.value || "");

      try {
        const resp = await fetch(API, { method: "POST", body: fd });
        const data = await resp.json();
        if (!data.ok) throw new Error(data.error || "Failed");

        lastText = data.analysis || "";
        resultEl.textContent = lastText || "(No content)";
        downloadBtn.disabled = !lastText;
        statusEl.textContent = "Done";
      } catch (e) {
        resultEl.textContent = "Failed\n\n" + e.message;
        statusEl.textContent = "Error";
      } finally {
        analyzeBtn.disabled = false;
      }
    };

    downloadBtn.onclick = () => {
      if (!lastText) return;
      const blob = new Blob([lastText], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "BizDoc_Report.txt";
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
